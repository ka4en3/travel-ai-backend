- auto-fill data
- auto generate share_code
- route_access
- JWT auth
- run Gunicorn + workers

- AICache CRUD
- migrations: add Data types to downgrade
- tests

alembic revision --autogenerate -m "Initial migration"
alembic upgrade head -v
alembic upgrade head --sql > migration.sql

uv sync --extra dev

docker compose down -v
docker-compose up --build -d

docker-compose logs api
docker-compose logs -f api

Check PostgreSQL logs: Access the logs from your PostgreSQL container:
docker logs pg

Direct container access: Connect to the PostgreSQL container directly to eliminate any host connectivity issues:
docker exec -it pg psql -U admin -d travel_ai_db
Then check for tables:
\dt



ğŸ”¹ 1. âœ… ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Alembic Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ
Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¸Ğ· Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
ğŸ” ĞŸĞ¾ÑĞ»Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ‘Ğ” Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°.

ğŸ”¹ 2. âœ… Pydantic-ÑÑ…ĞµĞ¼Ñ‹ (schemas/)
Ğ”Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ¸ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² API Ğ¸ Ğ±Ğ¾Ñ‚Ğµ.
UserCreate, RouteResponse, ActivityIn, AICacheOut, Ğ¸ Ñ‚.Ğ´.
ĞŸĞ¾Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ (Swagger), Ñ‚ĞµÑÑ‚Ñ‹ Ğ¸ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

ğŸ”¹ 3. âœ… Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ CRUD
ĞŸÑ€ÑĞ¼Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸: ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚, Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº, ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ChatGPT
get_user_by_telegram_id()
create_route(), get_routes_by_user_id()
cache_ai_response(), get_cached_result()

ğŸ”¹ 4. âœ… Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (services/)
AI, Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹, ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ â€” ĞºĞ°Ğº orchestrators
ai_service.py: Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ°
route_service.py: ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ / Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ / ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚
(Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ° Ğ±ĞµĞ· export_service)

ğŸ”¹ 5. âœ… ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ API (api/routes/*.py)
Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ¾Ğ¼
/ai/generate
/routes
/routes/{id}/export




â”œâ”€â”€ bot/                             # Telegram bot service
â”‚   â”œâ”€â”€ Dockerfile                   # Dockerfile for bot
â”‚   â”œâ”€â”€ requirements.txt             # Bot dependencies
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ bot.py                   # Aiogram entrypoint
â”‚       â”œâ”€â”€ config.py                # Bot config
â”‚       â”œâ”€â”€ handlers/                # Command logic
â”‚       â”‚   â”œâ”€â”€ start.py
â”‚       â”‚   â”œâ”€â”€ route.py
â”‚       â”‚   â””â”€â”€ export.py
â”‚       â”œâ”€â”€ keyboards/               # Inline/reply keyboards
â”‚       â”‚   â””â”€â”€ route_keyboard.py
â”‚       â””â”€â”€ states/                  # FSM conversation states
â”‚           â””â”€â”€ route_states.py



services:
  db:
    image: postgres:16
    container_name: db
    restart: always
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    volumes:
      - pgdata:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 10s
      timeout: 5s
      retries: 5v


  bot:
    build: ./bot
    container_name: bot
    env_file: .env
    depends_on:
      backend:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "echo", "ok"]
      interval: 30s
      timeout: 10s
      retries: 3